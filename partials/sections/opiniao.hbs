<section class="px-5 sm:px-6 mt-20 mb-20" data-section="opiniao"
  x-data
  x-init="
    const grid = $el.querySelector('[data-op-grid]');
    const cards = Array.from(grid.querySelectorAll('[data-author]'));

    // Agrupa por autor e mantém o mais recente
    const byAuthor = new Map();
    cards.forEach(card => {
      const slug = card.dataset.author;
      const date = new Date(card.dataset.published);
      const prev = byAuthor.get(slug);
      if (!prev || date > prev.date) byAuthor.set(slug, { date, el: card });
    });

    // Ordena por data desc e mantém 3
    const uniqueSorted = Array.from(byAuthor.values())
      .sort((a, b) => b.date - a.date)
      .slice(0, 3)
      .map(x => x.el);

    // Limpa grid e reinsere os 3 únicos
    grid.innerHTML = '';
    uniqueSorted.forEach(c => grid.appendChild(c));
  ">
  <div class="max-w-site mx-auto">

    {{> section-heading 
      section_title="Opinião"
      section_link="/opiniao/"
      section_link_text="Tudo em opinião"
    }}

    <div class="grid gap-10 sm:grid-cols-2 lg:grid-cols-3" data-op-grid>
      {{#get "posts" include="authors" filter="tag:opiniao" order="published_at desc" limit="15"}}
        {{#foreach posts}}
          <article 
            data-author="{{authors.[0].slug}}" 
            data-published="{{published_at}}" 
            class="flex flex-col text-left gap-3">

            {{!-- Cartola do autor (sem serifa, estilo de tag) --}}
            <div class="inline-flex items-center gap-3 font-sans font-semibold uppercase text-[0.8rem] md:text-[0.9rem]">
              {{#if authors.[0].profile_image}}
                <a href="{{authors.[0].url}}" class="flex-shrink-0">
                  <img 
                    src="{{authors.[0].profile_image}}" 
                    alt="{{authors.[0].name}}" 
                    class="rounded-full object-cover border border-brd-soft shrink-0"
                    style="width:60px; height:60px;"
                    loading="lazy">
                </a>
              {{/if}}

              <a href="{{authors.[0].url}}" 
                 class="text-brand decoration-2 underline-offset-2 hover:underline">
                {{authors.[0].name}}
              </a>
            </div>

            {{!-- Título do post (semibold, serif, maior) --}}
            <h3 class="font-serif text-lg font-semibold md:text-xl lg:text-2xl leading-tight md:leading-[1.15]" data-post-card-title>
              <a href="{{url}}" class="hover:underline underline-offset-4">
                <span>{{title}}</span>
              </a>
            </h3>
          </article>
        {{/foreach}}
      {{/get}}
    </div>
  </div>
</section>
